<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>模具材料計算系統 v1.3</title>

<style>
:root{
  --bg:#f5f5f7;
  --card:#ffffff;
  --text:#111;
  --muted:#666;
  --line:#e5e5e5;

  --a:#fff3e8;
  --b:#f1fbf3;
  --insertA:#fff0dc;
  --insertB:#e9f7ec;

  --hot:#ffe7d9;
  --eject:#e8f4ff;
  --leg:#d9d9d9;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC",sans-serif;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:1200px;
  margin:auto;
  padding:16px;
}

h1{font-size:22px;margin:0 0 12px}
h2{font-size:18px;margin:24px 0 8px}

.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 2px 10px rgba(0,0,0,.04);
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
@media(max-width:900px){
  .grid{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:600px){
  .grid{grid-template-columns:1fr}
}

.field label{
  font-size:13px;
  color:var(--muted);
}
.field input,.field select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--line);
  font-size:14px;
}

.btn{
  border:none;
  border-radius:14px;
  padding:14px;
  font-size:16px;
  background:#2f6df6;
  color:#fff;
  width:100%;
}

/* ===== 示意圖 ===== */
.diagram{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.block{
  border-radius:16px;
  padding:14px;
  font-weight:600;
}
.block small{font-weight:400;color:#555}

.clamp{background:#f1f1f1}
.aPlate{background:var(--a)}
.bPlate{background:var(--b)}

.insertA{
  margin-top:8px;
  padding:10px;
  border-radius:14px;
  background:var(--insertA);
  box-shadow:inset 0 4px 8px rgba(0,0,0,.06);
}
.insertB{
  margin-top:8px;
  padding:10px;
  border-radius:14px;
  background:var(--insertB);
  box-shadow:inset 0 4px 8px rgba(0,0,0,.06);
}

.row{
  display:flex;
  align-items:center;
  gap:8px;
}
.leg{
  width:80px;
  background:var(--leg);
  text-align:center;
  border-radius:10px;
  padding:20px 6px;
  font-size:13px;
}
.centerBox{
  flex:1;
  border-radius:14px;
  padding:12px;
  text-align:center;
}
.hot{background:var(--hot)}
.eject{background:var(--eject)}

/* ===== 表格（手機橫向滑動） ===== */
.tableWrap{
  width:100%;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}
.bomTable{
  width:100%;
  min-width:720px;
  border-collapse:collapse;
}
.bomTable th,.bomTable td{
  border:1px solid var(--line);
  padding:12px;
  text-align:center;
}
.bomTable th{
  background:#fafafa;
}
.bomTable tfoot td{
  font-weight:700;
  background:#fafafa;
}

@media(max-width:760px){
  .bomTable th,.bomTable td{
    font-size:13px;
    padding:10px 8px;
  }
}

/* 小提示：用 display:none 隱藏區塊 */
.hidden{display:none !important;}
</style>
</head>

<body>
<div class="container">

<h1>模具材料計算系統 v1.3</h1>

<div class="card grid">
  <div class="field">
    <label>成品投影長 Lp (mm)</label>
    <input id="Lp" type="number" value="1200">
  </div>
  <div class="field">
    <label>成品投影寬 Wp (mm)</label>
    <input id="Wp" type="number" value="500">
  </div>
  <div class="field">
    <label>成品厚度 Hp (mm)</label>
    <input id="Hp" type="number" value="40">
  </div>
</div>

<div class="card grid">
  <div class="field">
    <label>模具等級</label>
    <select id="cls">
      <option value="S">S</option>
      <option value="M" selected>M</option>
      <option value="L">L</option>
      <option value="XL">XL</option>
    </select>
  </div>

  <div class="field">
    <label>澆口系統</label>
    <select id="gate">
      <option value="cold">冷流道</option>
      <option value="hot" selected>熱澆道</option>
    </select>
  </div>

  <!-- ✅ 新增：Hot 時才顯示「熱澆道數量」 -->
  <div class="field" id="hotQtyWrap">
    <label>熱澆道數量（組）</label>
    <select id="hotQty">
      <option value="1" selected>1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>
  </div>

  <div class="field">
    <label>頂針板厚度 (mm)</label>
    <select id="epT">
      <option>20</option><option>25</option><option>30</option>
      <option selected>35</option><option>40</option><option>45</option>
    </select>
  </div>
</div>

<div class="card">
  <button class="btn" onclick="calc()">計算材料</button>
</div>

<div class="card">
  <h2>模具示意圖（淨厚）</h2>
  <div id="diagram" class="diagram"></div>
</div>

<div class="card">
  <h2>材料 BOM（體積：cm³｜重量：kg）</h2>
  <div class="tableWrap">
    <table class="bomTable">
      <thead>
        <tr>
          <th>項目</th>
          <th>尺寸 (mm)</th>
          <th>數量</th>
          <th>體積 (cm³)</th>
          <th>重量 (kg)</th>
        </tr>
      </thead>
      <tbody id="bomBody"></tbody>
      <tfoot>
        <tr>
          <td colspan="3">合計</td>
          <td id="vSum">0</td>
          <td id="wSum">0</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

</div>

<script>
const density=7.85; // g/cm3

const P={
  edge:{S:20,M:30,L:40,XL:50},
  clamp:{S:20,M:30,L:40,XL:50},
  insert:{S:40,M:80,L:120,XL:160},
  hotMin:{S:300,M:400,L:500,XL:580}
};

function vol(l,w,t){ return Math.round(l*w*t/1000); }         // mm^3 -> cm^3
function kg(v){ return Math.round(v*density/1000); }          // cm^3 * g/cm^3 -> kg (rounded)

// ✅ Hot 顯示邏輯
function syncHotUI(){
  const isHot = (gateEl.value === "hot");
  hotQtyWrap.classList.toggle("hidden", !isHot);
}

function calc(){
  const Lp=+LpEl.value, Wp=+WpEl.value, Hp=+HpEl.value;
  const cls=clsEl.value;
  const gate=gateEl.value;
  const ep=+epTEl.value;

  // ✅ Hot 數量（只有 hot 才讀，cold 直接當 0）
  const hotQty = (gate==="hot") ? (+hotQtyEl.value || 1) : 0;

  const Lm=Lp+2*P.edge[cls];
  const Wm=Wp+2*P.edge[cls];
  const Wcl=Wm+2*P.clamp[cls];

  const Wins=Wp+2*P.insert[cls];
  const Wneed=(gate==="hot") ? Math.max(Wins,P.hotMin[cls]) : Wins;

  const legW=Math.max(0, Math.round((Wm-Wneed)/2));
  const A_legH=(gate==="hot") ? 70 : 0;

  diagram.innerHTML=`
    <div class="block clamp">上封頂板<br><small>W=${Wcl}</small></div>

    ${gate==="hot" ? `
    <div class="row">
      <div class="leg">腳</div>
      <div class="centerBox hot">熱澆道<br>W_need=${Wneed}｜數量=${hotQty}</div>
      <div class="leg">腳</div>
    </div>` : ""}

    <div class="block aPlate">母模板 A<br><small>W=${Wm}</small>
      <div class="insertA">模仁區域（示意） ${Wins}×${Wins}</div>
    </div>

    <div class="block bPlate">公模板 B<br><small>W=${Wm}</small>
      <div class="insertB">模仁區域（示意） ${Wins}×${Wins}</div>
    </div>

    <div class="row">
      <div class="leg">腳</div>
      <div class="centerBox eject">上/下頂針板<br>W=${Wneed}</div>
      <div class="leg">腳</div>
    </div>

    <div class="block clamp">下封頂板<br><small>W=${Wcl}</small></div>
  `;

  // ===== BOM =====
  // 鋼材：照原邏輯計；熱澆道本體是外購件，所以 BOM 只顯示「數量」，重量/體積=0
  const bom=[];

  bom.push(["上封頂板",`${Lm}×${Wcl}×50`,1,vol(Lm,Wcl,50)]);

  // ✅ 新增：熱澆道（組）顯示在 BOM（不納入重量/體積）
  if(gate==="hot"){
    bom.push(["熱澆道（組）",`-`,hotQty,0]);
  }

  // 這兩列保留你目前畫面邏輯（示意）
  bom.push(["母模板 A（含Hp+加工餘量）",`${Lm}×${Wm}×${Hp+134}`,1,vol(Lm,Wm,Hp+134)]);
  bom.push(["公模板 B（含Hp+加工餘量）",`${Lm}×${Wm}×${Hp*2+231}`,1,vol(Lm,Wm,Hp*2+231)]);

  // Hot 時 A 70mm 空間鋼材（如果你要也進 BOM，可取消註解）
  // if(gate==="hot"){
  //   bom.push(["母模腳（A，側框｜固定70）",`${Lm}×${legW}×${A_legH}`,2,vol(Lm,legW,A_legH)*2]);
  // }

  bom.push(["公模腳 (B，側框）",`${Lm}×${legW}×108`,2,vol(Lm,legW,108)*2]);
  bom.push(["上頂針板（中間）",`${Lm}×${Wneed}×${ep}`,1,vol(Lm,Wneed,ep)]);
  bom.push(["下頂針板（中間）",`${Lm}×${Wneed}×${ep}`,1,vol(Lm,Wneed,ep)]);
  bom.push(["下封頂板",`${Lm}×${Wcl}×50`,1,vol(Lm,Wcl,50)]);

  bomBody.innerHTML="";
  let vs=0, ws=0;

  bom.forEach(r=>{
    const v=r[3] || 0;
    const w=kg(v);
    vs += v;
    ws += w;
    bomBody.innerHTML += `<tr>
      <td>${r[0]}</td>
      <td>${r[1]}</td>
      <td>${r[2]}</td>
      <td>${v}</td>
      <td>${w}</td>
    </tr>`;
  });

  vSum.textContent = vs;
  wSum.textContent = ws;
}

const LpEl=document.getElementById("Lp");
const WpEl=document.getElementById("Wp");
const HpEl=document.getElementById("Hp");
const clsEl=document.getElementById("cls");
const gateEl=document.getElementById("gate");
const hotQtyWrap=document.getElementById("hotQtyWrap");
const hotQtyEl=document.getElementById("hotQty");
const epTEl=document.getElementById("epT");

gateEl.addEventListener("change", ()=>{ syncHotUI(); calc(); });
hotQtyEl.addEventListener("change", calc);
clsEl.addEventListener("change", calc);
LpEl.addEventListener("input", calc);
WpEl.addEventListener("input", calc);
HpEl.addEventListener("input", calc);
epTEl.addEventListener("change", calc);

syncHotUI();
calc();
</script>
</body>
</html>
